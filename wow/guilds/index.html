<!DOCTYPE HTML>
<html>
    <head>
        <title>WoW - Characters and Guilds</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

        <!--Bootstrap -->
        <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
        <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- End Bootstrap -->
        <script type="text/javascript" src="/bower_components/tablesorter/jquery.tablesorter.min.js"></script>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h3>Wow Finder</h3>
                </div>
            </div>
            <div class="row" style="margin-bottom:10px;">
                <div id="realmNameInput-container" class="col-md-3">
                    <div class="form-group">
                        <label for="realmNameInput">Realm Name</label>
                        <input id="realmNameInput" class="form-control" placeholder="Realm Name" value="Dalaran" />
                    </div>
                </div>
                <div id="guildNameInput-container" class="col-md-3">
                    <div class="form-group">
                        <label for="guildNameInput">Guild Name</label>
                        <input list="guildNameInput" name="guildNameInput" class="form-control" placeholder="Guild Name">
                        <datalist id="guildNameInput">
                            <option value="Reign Of Bloods">Reign Of Bloods</option>
                        </datalist>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="btn-toolbar" style="margin-top:4.25%;">
                        <button type="button" id="searchButton" class="btn btn-primary">Search</button>
                    </div>
                </div>
            </div>
            <table id="members-table" class="table table-bordered table-height table-collapsed tablesorter">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Level</th>
                        <th>Achievement Points</th>
                        <th>Specialty</th>
                        <th>Race</th>
                        <th>Class</th>
                        <th>Role</th>
                        <!--
                        <th>Name</th>
                        <th>Role</th>
                        <th>Description</th>
                        -->
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="7">Enter the Character Realm and Character Name to start.</td>
                    <tr>
                </tbody>
            </table>
        </div>

    </body>
    <script type="text/javascript" src="/js/cookie.js"></script>
    <script type="text/javascript" src="/js/wow.js"></script>
    <script type="text/javascript">
        var realmName = "Dalaran";
        //     guildName = "Reign Of Bloods",
        //     characterName = "Granlexios",
            apiKey = 'kja9u5sbtyq9cy8vmfwm294ag8d2hsp2';



        function getGuildMembers(realmName,guildName) {
            console.log(realmName,guildName)
            if (realmName && guildName) {
                $.getJSON('https://us.api.battle.net/wow/guild/'+realmName+'/'+guildName+'?fields=members&locale=en_US&apikey='+apiKey,
                    {},
                    function(data) {
                        var members = data.members,
                            membersHtml = '';
                        // console.log(members.length);
                        if (members.length>=0) {
                            members.forEach(function(member) {
                                var character = member.character;
                                membersHtml+='<tr class="character-info" data-character="'+character.name+'">';
                                membersHtml+='<td>'+character.name+'</td>';
                                membersHtml+='<td>'+character.level+'</td>';
                                membersHtml+='<td>'+ character.achievementPoints +'</td>';
                                membersHtml+='<td>'+getRace(character.race)+'</td>';
                                membersHtml+='<td>'+getClass(character.class)+'</td>';
                                if(character.spec) {
                                    membersHtml+='<td>'+ character.spec.name +'</td>';
                                    membersHtml+='<td>'+ character.spec.role +'</td>';
                                } else {
                                    membersHtml+='<td>None</td>';
                                    membersHtml+='<td>None</td>';
                                }
                                membersHtml+='</tr>';
                            });
                        } else {
                            membersHtml+='<tr>';
                            membersHtml+='<td colspan="7">There is no Guild found with that name in this Realm.</td>';
                            membersHtml+='</tr>';
                        }

                        $('#members-table tbody').html(membersHtml);
                        $('#realmNameInput').val(realmName);
                    }
                );
            }

        };

        $(document).ready(function() {

            $(document).on('click','.character-info',function(e) {
                e.preventDefault();
                var characterInfo = $(this).data('character');
                console.log(characterInfo);
            });

            $('#searchButton').click(function() {
                var realmName = $('#realmNameInput').val(),
                    guildName = $('input[name=guildNameInput]').val();
;
                getGuildMembers(realmName,guildName);
            });

            $('#members-table').tablesorter();
        })
    </script>
    <script type="text/javascript" src="/js/analytics.js"></script>
</html>